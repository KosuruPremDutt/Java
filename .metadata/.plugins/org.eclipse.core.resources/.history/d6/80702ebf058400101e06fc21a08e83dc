package com.wipro.controller;

import com.wipro.Entities.Appointment;
import com.wipro.Entities.Doctor;
import com.wipro.repository.AppointmentRepository;
import com.wipro.repository.DoctorRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.time.LocalDateTime;
import java.util.List;

@CrossOrigin(origins = "http://localhost:4200")
@RestController
@RequestMapping("/api/appointments")
public class AppointmentController {

	@Autowired
	private AppointmentRepository appointmentRepo;

	@Autowired
	private DoctorRepository doctorRepo;

	@GetMapping
	public List<Appointment> getAllAppointments() {
		return appointmentRepo.findAll();
	}

	@PostMapping
	public Appointment addAppointment(@RequestBody AppointmentDTO appointmentDTO) {
		Doctor doctor = doctorRepo.findById(appointmentDTO.getDoctorId())
				.orElseThrow(() -> new RuntimeException("Doctor not found"));

		LocalDateTime appointmentTime = LocalDateTime.parse(appointmentDTO.getDate() + "T" + appointmentDTO.getTime());

		Appointment appointment = new Appointment();
		appointment.setDoctor(doctor);
		appointment.setPatientName(appointmentDTO.getPatientName());
		appointment.setAppointmentTime(appointmentTime);

		return appointmentRepo.save(appointment);
	}

	// DTO Inner Class
	static class AppointmentDTO {
		private Long doctorId;
		private String patientName;
		private String date;
		private String time;
		private String contact;

		// Getters and Setters
		public Long getDoctorId() {
			return doctorId;
		}

		public void setDoctorId(Long doctorId) {
			this.doctorId = doctorId;
		}

		public String getPatientName() {
			return patientName;
		}

		public void setPatientName(String patientName) {
			this.patientName = patientName;
		}

		public String getDate() {
			return date;
		}

		public void setDate(String date) {
			this.date = date;
		}

		public String getTime() {
			return time;
		}

		public void setTime(String time) {
			this.time = time;
		}

		public String getContact() {
			return contact;
		}

		public void setContact(String contact) {
			this.contact = contact;
		}
	}
}
